<!-- è‹±é›„è¯¦æƒ…é¡µé¢ -->
<navigation-bar title="è‹±é›„è¯¦æƒ…" showBack="{{true}}" showHome="{{true}}" background="transparent"></navigation-bar>
<view class="hero-detail-page">
  <!-- éª¨æ¶å±åŒ…è£¹ -->
  <skeleton loading="{{loading}}">
    <!-- æ²‰æµ¸å¼å¤´éƒ¨ (Parallax Header) -->
    <view class="hero-header-immersive">
      <image class="hero-bg-image" src="{{hero.avatar}}" mode="aspectFill" />
      <view class="hero-header-overlay"></view>
      <view class="hero-header-content animate-slide-up">
        <view class="hero-avatar-wrapper">
          <image class="hero-avatar" src="{{hero.avatar}}" mode="aspectFill" />
        </view>
        <view class="hero-title-group">
          <text class="hero-name font-serif">{{hero.name}}</text>
          <view class="hero-badges">
            <text class="badge-era">{{hero.era}}</text>
            <text class="badge-title">{{hero.title}}</text>
          </view>
          <text class="hero-years">{{hero.birth_year}} - {{hero.death_year || 'è‡³ä»Š'}}</text>
        </view>
      </view>
    </view>

    <!-- å†…å®¹åŒºåŸŸ (Glassmorphism Cards) -->
    <view class="content-scroll">
      <!-- ç”Ÿå¹³äº‹è¿¹ -->
      <view class="content-card animate-slide-up" style="animation-delay: 0.1s;">
        <view class="section-header">
          <image class="section-icon-img" src="/images/icons/biography.png" mode="aspectFit" />
          <text class="section-title font-serif">ç”Ÿå¹³äº‹è¿¹</text>
        </view>
        <view class="text-justified-container">
          <!-- Drop Cap Implementation -->
          <view class="biography-content">
            <text class="drop-cap font-serif">{{hero.biography_first_char}}</text>
            <text class="biography-text">{{hero.biography_rest}}</text>
          </view>
        </view>
        <!-- SVG Divider -->
        <view class="section-divider">
          <image class="divider-img" src="/images/decorations/ink-stroke.svg" mode="widthFix" />
        </view>
      </view>

      <!-- ä¸»è¦è´¡çŒ® -->
      <view class="content-card animate-slide-up" style="animation-delay: 0.2s;">
        <view class="section-header">
          <image class="section-icon-img" src="/images/icons/medal.png" mode="aspectFit" />
          <text class="section-title font-serif">ä¸»è¦è´¡çŒ®</text>
        </view>
        <view class="deeds-grid">
          <view 
            class="deed-medal"
            wx:for="{{hero.main_deeds}}"
            wx:key="index"
          >
            <view class="medal-icon">
              <text>ğŸ–ï¸</text>
            </view>
            <text class="medal-text">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- åè¨€è­¦å¥ -->
      <view class="content-card animate-slide-up" style="animation-delay: 0.3s;" wx:if="{{hero.famous_quotes && hero.famous_quotes.length > 0}}">
        <view class="section-header">
          <image class="section-icon-img" src="/images/icons/quote.png" mode="aspectFit" />
          <text class="section-title font-serif">åè¨€è­¦å¥</text>
        </view>
        <view class="quotes-container">
          <view 
            class="quote-magazine-style"
            wx:for="{{hero.famous_quotes}}"
            wx:key="index"
          >
            <text class="quote-symbol-large left">â€œ</text>
            <text class="quote-content font-serif">{{item}}</text>
            <text class="quote-symbol-large right">â€</text>
          </view>
        </view>
      </view>
      
      <!-- åº•éƒ¨å®‰å…¨åŒº -->
      <view class="safe-bottom-spacer"></view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  (Floating Glass) -->
    <view class="action-bar-glass animate-fade-in">
      <button class="action-btn secondary" open-type="share">
        <text class="icon-share">ğŸ“¤</text>
        <text>åˆ†äº«å¥½å‹</text>
      </button>
      <view class="action-btn secondary" bindtap="generatePoster">
        <text class="icon-share">ğŸ–¼ï¸</text>
        <text>ç”Ÿæˆæµ·æŠ¥</text>
      </view>
      <view class="action-btn primary" bindtap="onChatWithHero">
        <text class="icon-chat">ğŸ¤–</text>
        <text>ä¸{{hero.name}}å¯¹è¯</text>
      </view>
    </view>
  </skeleton>

  <!-- æµ·æŠ¥ç”»å¸ƒ (éšè—) -->
  <canvas canvas-id="posterCanvas" class="poster-canvas-hidden" style="width: 375px; height: 600px;"></canvas>

  <!-- æµ·æŠ¥é¢„è§ˆå¼¹çª— -->
  <view wx:if="{{showPosterPreview}}" class="poster-modal" bindtap="closePosterPreview">
    <view class="poster-modal-content" catchtap="">
      <view class="poster-preview-wrapper">
        <image class="poster-preview-img" src="{{posterPath}}" mode="widthFix"></image>
      </view>
      <view class="poster-actions">
        <button class="poster-btn save-btn" bindtap="savePoster">
          <text>ğŸ’¾</text>
          <text>ä¿å­˜åˆ°ç›¸å†Œ</text>
        </button>
        <button class="poster-btn close-btn" bindtap="closePosterPreview">
          <text>å…³é—­</text>
        </button>
      </view>
    </view>
  </view>

  <!-- ç”Ÿæˆä¸­æç¤º -->
  <view wx:if="{{generatingPoster}}" class="generating-mask">
    <view class="generating-content">
      <view class="generating-spinner"></view>
      <text class="generating-text">æ­£åœ¨ç”Ÿæˆæµ·æŠ¥...</text>
    </view>
  </view>
</view>