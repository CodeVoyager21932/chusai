<!--index.wxml-->
<!-- A åŒºï¼šé¡¶éƒ¨å¯¼èˆªä¸æœç´¢ (å¸é¡¶ + æ²‰æµ¸å¼é€‚é…) -->
<view class="custom-header" style="height: {{totalHeaderHeight}}px; padding-top: {{statusBarHeight}}px;">
  <view class="nav-bar-content" style="height: {{navBarHeight}}px;">
    <!-- ç”¨æˆ·å¤´åƒ -->
    <image 
      class="nav-avatar" 
      style="width: {{capsuleHeight}}px; height: {{capsuleHeight}}px;"
      src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" 
      bindtap="goToProfile"
    />
    
    <!-- æœç´¢æ  -->
    <view class="nav-search-bar" style="height: {{capsuleHeight}}px;" bindtap="openGlobalSearch">
      <text class="search-icon">ğŸ”</text>
      <text class="search-placeholder">æœç´¢è‹±é›„ã€å²æ–™...</text>
    </view>
  </view>
</view>

<view class="home-page" style="padding-top: {{totalHeaderHeight}}px;">
  <!-- é¡¶éƒ¨èƒŒæ™¯è£…é¥° (Curtain Effect) -->
  <view class="header-curtain"></view>

  <!-- ä»Šæ—¥è‹±é›„å¡ç‰‡ (Premium Card) -->
  <view class="section-title animate-fade-in" style="animation-delay: 0.1s;">
    <text class="font-serif">ä»Šæ—¥è‹±é›„</text>
    <text class="date-badge">{{todayDate}}</text>
  </view>
  
  <wxs module="gesture" src="./card-gesture.wxs"></wxs>

  <!-- B åŒºï¼šé¦–å±æ ¸å¿ƒå±•ç¤ºåŒº (Hero Section) -->
  <view class="hero-card-container">
  <view class="today-hero-card card-hover animate-fade-in" 
        style="animation-delay: 0.2s;" 
        bindtouchstart="{{gesture.touchStart}}"
        bindtouchmove="{{gesture.touchMove}}"
        bindtouchend="{{gesture.touchEnd}}"
        bindtouchcancel="{{gesture.touchEnd}}"
  >
    <view class="card-glare" style="{{heroCardGlare}}"></view>
    <view class="hero-bg-gradient"></view>
    
    <!-- è‹±é›„å†…å®¹ -->
    <view class="hero-content" bindtap="goToHeroDetail">
      <view class="hero-badge">
        <text>â­ æ¯æ—¥æ¨è</text>
      </view>
      <view class="hero-main">
        <view class="hero-avatar-wrapper">
          <image 
            class="hero-avatar" 
            src="{{todayHero.avatar}}" 
            mode="aspectFill"
            binderror="onImageError"
          />
          <view class="hero-placeholder" wx:if="{{!todayHero.avatarLoaded}}">
            <text class="placeholder-text">{{todayHero.name[0]}}</text>
          </view>
        </view>
        <view class="hero-text-group">
          <text class="hero-name font-serif">{{todayHero.name}}</text>
          <text class="hero-title">{{todayHero.title || 'é©å‘½è‹±é›„'}}</text>
          <text class="hero-desc">{{todayHero.brief}}</text>
        </view>
      </view>
    </view>

    <!-- æ¯æ—¥æˆé•¿ä»»åŠ¡è¦†ç›–å±‚ (Glassmorphism) -->
    <view class="daily-task-overlay" bindtap="goToDailyTask" catchtap="goToDailyTask">
      <view class="task-capsule">
        <view class="task-icon">âœ¨</view>
        <view class="task-content">
          <text class="task-label">ä»Šæ—¥ä»»åŠ¡</text>
          <text class="task-desc">{{dailyTaskDesc}}</text>
        </view>
        <view class="task-arrow">â†’</view>
      </view>
    </view>
  </view>
  <!-- æ¯æ—¥æˆé•¿è·¯å¾„ - æŒ‚è½½åœ¨å¡ç‰‡å³ä¸Šè§’ -->
  <daily-path />
  </view>

  <!-- C åŒºï¼šæ ¸å¿ƒåŠŸèƒ½çŸ©é˜µ (2x2 å¤§å¡ç‰‡) -->
  <view class="section-title animate-fade-in" style="animation-delay: 0.3s;">
    <text class="font-serif">æ ¸å¿ƒåŠŸèƒ½</text>
  </view>

  <view class="main-function-grid animate-fade-in" style="animation-delay: 0.4s;">
    <!-- Card 1: AI è®²è§£å‘˜ -->
    <view class="main-card card-hover" bindtap="goToAIChat">
      <view class="card-bg gradient-ai"></view>
      <view class="card-content">
        <view class="card-icon-large">ğŸ¤–</view>
        <view class="card-text">
          <text class="card-title">AI è®²è§£å‘˜</text>
          <text class="card-subtitle">äº’åŠ¨å¯¹è¯</text>
        </view>
      </view>
      <view class="card-decoration">ğŸ’¬</view>
    </view>

    <!-- Card 2: æ—¶ç©ºå›¾è°± -->
    <view class="main-card card-hover" bindtap="goToGraph">
      <view class="card-bg gradient-graph"></view>
      <view class="card-content">
        <view class="card-icon-large">ğŸ•¸ï¸</view>
        <view class="card-text">
          <text class="card-title">æ—¶ç©ºå›¾è°±</text>
          <text class="card-subtitle">å¯è§†åŒ–å†å²</text>
        </view>
      </view>
      <view class="card-decoration">ğŸ—ºï¸</view>
    </view>

    <!-- Card 3: æ˜Ÿç«ç‡åŸ -->
    <view class="main-card card-hover" bindtap="goToSparkPrairie">
      <view class="card-bg gradient-spark"></view>
      <view class="card-content">
        <view class="card-icon-large">ğŸ”¥</view>
        <view class="card-text">
          <text class="card-title">æ˜Ÿç«ç‡åŸ</text>
          <text class="card-subtitle">å­¦ä¹  & PK</text>
        </view>
      </view>
      <view class="card-decoration">âš”ï¸</view>
    </view>

    <!-- Card 4: çº¢è‰²çè— -->
    <view class="main-card card-hover" bindtap="goToRedHeritage">
      <view class="card-bg gradient-heritage"></view>
      <view class="card-content">
        <view class="card-icon-large">ğŸ›ï¸</view>
        <view class="card-text">
          <text class="card-title">çº¢è‰²çè—</text>
          <text class="card-subtitle">å±•å… & è§£å¯†</text>
        </view>
        <!-- æ–°è·å–å¾½æ ‡ -->
        <view wx:if="{{hasNewHeritage}}" class="new-badge">æ–°è·å–</view>
      </view>
      <view class="card-decoration">ğŸ</view>
    </view>
  </view>

  <!-- D åŒºï¼šæ¢ç´¢å‘ç°åŒº (Discovery Zone) -->
  <view class="section-title animate-fade-in" style="animation-delay: 0.5s;">
    <text class="font-serif">æ¢ç´¢å‘ç°</text>
  </view>

  <!-- Item 1: çº¢è‰²è¶³è¿¹ - å®½å¹…çŸ©å½¢å¡ç‰‡ -->
  <view class="discovery-section animate-fade-in" style="animation-delay: 0.6s;">
    <view class="footprints-card" bindtap="goToRedFootprints">
      <view class="footprints-bg"></view>
      <view class="footprints-content">
        <view class="footprints-icon">ğŸ“</view>
        <view class="footprints-text">
          <text class="footprints-title">çº¢è‰²è¶³è¿¹</text>
          <text class="footprints-desc">å¯»æ‰¾èº«è¾¹çš„çº¢è‰²åœ°æ ‡</text>
        </view>
        <view class="footprints-arrow">â†’</view>
      </view>
    </view>
  </view>

  <!-- Item 2: è‹±é›„é•¿å»Š - æ¨ªå‘æ»šåŠ¨åˆ—è¡¨ -->
  <view class="hero-gallery-section animate-fade-in" style="animation-delay: 0.7s;">
    <view class="gallery-header">
      <text class="gallery-title">è‹±é›„é•¿å»Š</text>
      <view class="gallery-more" bindtap="goToHeroes">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="more-arrow">â†’</text>
      </view>
    </view>
    
    <scroll-view class="hero-scroll" scroll-x enable-flex>
      <view class="hero-list">
        <view wx:for="{{heroList}}" wx:key="id" 
              class="hero-item" 
              bindtap="goToHeroDetailById" 
              data-id="{{item.id}}">
          <image class="hero-avatar-small" src="{{item.avatar}}" mode="aspectFill" />
          <text class="hero-name-small">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å…¨å±€éŸ³é¢‘æ’­æ”¾å™¨ -->
  <audio-player></audio-player>

  <!-- å­¦ä¹ ç»Ÿè®¡ (Dashboard Widget) -->
  <view class="stats-section animate-fade-in" style="animation-delay: 0.4s;">
    <view class="stats-card card-hover">
      <view class="stats-header">
        <text class="font-serif title-medium">å­¦ä¹ æˆå°±</text>
        <view class="level-badge" bindtap="showBadgeDetail">Lv.{{userLevel || 1}} æ˜Ÿç«ç‡åŸ</view>
      </view>
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-num">{{stats.continuous_days}}<text class="stat-unit">å¤©</text></text>
          <text class="stat-label">è¿ç»­æ‰“å¡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.mastered_cards}}<text class="stat-unit">å¼ </text></text>
          <text class="stat-label">æŒæ¡å¡ç‰‡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.ai_chat_count}}<text class="stat-unit">æ¬¡</text></text>
          <text class="stat-label">AIäº’åŠ¨</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Floating Action Button (FAB) for Daily Sign -->
  <view class="fab-daily-sign animate-fade-in" bindtap="onOpenDailySign">
    <text class="fab-icon">ğŸ“…</text>
    <text class="fab-text">æ—¥ç­¾</text>
  </view>
</view>

<!-- æ—¥ç­¾å¼¹çª— -->
<!-- æ—¥ç­¾å¼¹çª— (æ—¶ç©ºæ¥ä¿¡) -->
<daily-letter 
  visible="{{showDailySign}}" 
  content="{{todayQuote.quote_content}}"
  quote="{{todayQuote.quote_content}}"
  author="{{todayQuote.author}}"
  bind:close="onCloseDailySign"
  bind:checkin="onDailyCheckIn"
></daily-letter>

<!-- å¾½ç« è¯¦æƒ…å¼¹çª— -->
<badge-modal
  visible="{{showBadgeModal}}"
  badge="{{currentBadge}}"
  bind:close="onCloseBadgeModal"
></badge-modal>

<!-- å…¨å±€æœç´¢ç»„ä»¶ -->
<global-search id="global-search" />
